<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Attendance - Modern UI</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    /* Reset and base */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body {
      margin: 0; padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
        Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background: #f9fafb;
      color: #1f2937;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      background: #4f46e5; /* Indigo-600 */
      color: white;
      padding: 1.5rem 1rem;
      text-align: center;
      font-weight: 700;
      font-size: 1.8rem;
      letter-spacing: 0.05em;
      box-shadow: 0 2px 6px rgb(79 70 229 / 0.3);
    }

    main {
      flex: 1;
      max-width: 720px;
      margin: 2rem auto 3rem;
      width: 90%;
    }

    section {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 8px 20px rgb(0 0 0 / 0.08);
      transition: box-shadow 0.3s ease;
    }
    section:hover {
      box-shadow: 0 12px 28px rgb(79 70 229 / 0.25);
    }
    h2 {
      margin-top: 0;
      margin-bottom: 1rem;
      font-weight: 600;
      color: #4338ca; /* Indigo-700 */
      letter-spacing: 0.03em;
    }

    input[type="text"] {
      width: 100%;
      padding: 0.85rem 1rem;
      border-radius: 0.75rem;
      border: 1.8px solid #cbd5e1; /* slate-300 */
      font-size: 1rem;
      font-weight: 500;
      transition: border-color 0.3s ease;
      outline-offset: 2px;
      color: #1e293b;
    }
    input[type="text"]:focus {
      border-color: #6366f1; /* Indigo-500 */
      outline: none;
      box-shadow: 0 0 6px rgb(99 102 241 / 0.6);
    }

    button {
      margin-top: 1rem;
      width: 100%;
      background: #6366f1; /* Indigo-500 */
      border: none;
      padding: 0.95rem;
      font-size: 1.15rem;
      font-weight: 600;
      color: white;
      border-radius: 0.85rem;
      cursor: pointer;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      user-select: none;
    }
    button:hover {
      background: #4f46e5; /* Indigo-600 */
      box-shadow: 0 6px 15px rgb(79 70 229 / 0.5);
    }
    button:active {
      transform: translateY(1px);
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 12px;
      font-weight: 500;
      font-size: 1rem;
      color: #334155; /* slate-700 */
    }
    thead th {
      padding-bottom: 0.8rem;
      text-align: left;
      border-bottom: 2px solid #e0e7ff; /* indigo-100 */
      color: #4338ca; /* Indigo-700 */
    }
    tbody tr {
      background: #f1f5ff; /* indigo-50 */
      border-radius: 1rem;
      box-shadow: 0 2px 6px rgb(99 102 241 / 0.15);
      transition: background 0.3s ease;
    }
    tbody tr:hover {
      background: #e0e7ff; /* indigo-100 */
    }
    tbody td {
      padding: 0.8rem 1rem;
      border-radius: 1rem;
      vertical-align: middle;
      word-break: break-word;
    }

    /* Floating action button */
    .fab {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 64px;
      height: 64px;
      background: #6366f1;
      border-radius: 50%;
      color: white;
      font-size: 2.4rem;
      line-height: 64px;
      text-align: center;
      cursor: pointer;
      box-shadow: 0 6px 20px rgb(99 102 241 / 0.7);
      user-select: none;
      transition: background 0.3s ease, box-shadow 0.3s ease;
      z-index: 999;
    }
    .fab:hover {
      background: #4f46e5;
      box-shadow: 0 8px 26px rgb(79 70 229 / 0.8);
    }

    /* Snackbar notification */
    .snackbar {
      position: fixed;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%);
      background: #4338ca;
      color: white;
      padding: 1rem 1.8rem;
      border-radius: 1rem;
      box-shadow: 0 8px 24px rgb(67 56 202 / 0.8);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.4s ease, visibility 0.4s ease;
      font-weight: 600;
      font-size: 1.1rem;
      pointer-events: none;
      user-select: none;
      z-index: 1000;
    }
    .snackbar.show {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }

    /* Scanner modal */
    #scanner {
      position: fixed;
      inset: 0;
      background: rgba(31, 41, 55, 0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: 1rem;
      backdrop-filter: blur(5px);
      border-radius: 1rem;
      flex-direction: column;
    }
    #reader {
      width: 320px;
      max-width: 100vw;
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 0 25px rgb(67 56 202 / 0.5);
    }
    #scanner button {
      margin-top: 1rem;
      max-width: 320px;
      width: 100%;
      padding: 0.75rem;
      background: #ef4444; /* red-500 */
      color: white;
      font-weight: 700;
      border-radius: 0.85rem;
      border: none;
      cursor: pointer;
      box-shadow: 0 6px 16px rgb(239 68 68 / 0.6);
      transition: background 0.3s ease;
    }
    #scanner button:hover {
      background: #b91c1c; /* red-700 */
      box-shadow: 0 8px 20px rgb(185 28 28 / 0.8);
    }

    @media (max-width: 480px) {
      main {
        margin: 1rem auto 2rem;
        width: 95%;
      }
      .fab {
        width: 56px;
        height: 56px;
        font-size: 2rem;
        line-height: 56px;
        bottom: 16px;
        right: 16px;
      }
      #reader {
        width: 280px;
      }
    }
  </style>
</head>
<body>

  <header>STUDENT ATTENDANCE</header>

  <main>

    <section id="manual-section" aria-label="Manual attendance entry">
      <h2>Manual Entry</h2>
      <input
        type="text"
        id="manualEntry"
        placeholder="Enter ID|Name (e.g. 123|John Doe)"
        aria-describedby="manualDesc"
        aria-label="Manual entry of student ID and name"
        autocomplete="off"
      />
      <button type="button" onclick="markManual()">Mark Present</button>
      <small id="manualDesc" style="color:#6b7280; font-weight:500; display:block; margin-top:0.3rem;">
        Format: ID and Name separated by '|'
      </small>
    </section>

    <section aria-label="Attendance list">
      <h2>Attendance List</h2>
      <table aria-live="polite" aria-describedby="attendanceDesc" role="table">
        <thead>
          <tr>
            <th scope="col" style="width: 25%;">ID</th>
            <th scope="col" style="width: 50%;">Name</th>
            <th scope="col" style="width: 25%;">Time</th>
          </tr>
        </thead>
        <tbody id="attendanceBody" role="rowgroup"></tbody>
      </table>
      <div style="margin-top:1rem; display: flex; gap: 1rem; flex-wrap: wrap;">
        <button type="button" onclick="exportCSV()" style="flex:1 1 45%;">Export CSV</button>
        <button type="button" onclick="resetAttendance()" style="flex:1 1 45%; background:#f87171;">Reset All</button>
      </div>
    </section>

  </main>

  <div class="fab" role="button" aria-label="Open QR code scanner" tabindex="0" onclick="openScanner()">ðŸ“·</div>

  <div id="scanner" role="dialog" aria-modal="true" aria-labelledby="scannerTitle" aria-describedby="scannerDesc">
    <h2 id="scannerTitle" style="color:white; margin-bottom:1rem;">Scan QR Code</h2>
    <div id="reader"></div>
    <button type="button" onclick="closeScanner()">Close Scanner</button>
  </div>

  <div class="snackbar" id="snackbar" role="alert" aria-live="assertive"></div>

<script>
  const STORAGE_KEY = "studentAttendance";

  function showSnackbar(text) {
    const snackbar = document.getElementById("snackbar");
    snackbar.textContent = text;
    snackbar.classList.add("show");
    setTimeout(() => snackbar.classList.remove("show"), 2500);
  }

  function saveData(data) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  function getData() {
    return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
  }

  function markAttendance(entry) {
    const parts = entry.split("|").map(s => s.trim());
    if (parts.length < 2 || !parts[0] || !parts[1]) {
      alert("Invalid format. Use ID|Name");
      return;
    }
    const id = parts[0];
    const name = parts.slice(1).join(" ");
    const data = getData();
    if (!data[id]) {
      data[id] = { name, time: new Date().toLocaleString() };
      saveData(data);
      loadTable();
      showSnackbar(`Marked: ${name}`);
    } else {
      showSnackbar(`${name} already marked`);
    }
  }

  function markManual() {
    const input = document.getElementById("manualEntry");
    const val = input.value.trim();
    if (val) {
      markAttendance(val);
      input.value = "";
    }
  }

  function loadTable() {
    const data = getData();
    const tbody = document.getElementById("attendanceBody");
    tbody.innerHTML = "";
    for (const id in data) {
      const { name, time } = data[id];
      const row = `
        <tr>
          <td>${id}</td>
          <td>${name}</td>
          <td>${time}</td>
        </tr>
      `;
      tbody.insertAdjacentHTML("beforeend", row);
    }
  }

  function exportCSV() {
    const data = getData();
    let csv = "ID,Name,Time\n";
    for (const id in data) {
      const { name, time } = data[id];
      csv += `"${id}","${name}","${time}"\n`;
    }
    const blob = new Blob([csv], { type: "text/csv" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "attendance.csv";
    link.click();
  }

  function resetAttendance() {
    if (confirm("Are you sure you want to clear all attendance records?")) {
      localStorage.removeItem(STORAGE_KEY);
      loadTable();
      showSnackbar("Attendance reset");
    }
  }

  function openScanner() {
    document.getElementById("scanner").style.display = "flex";
    const qr = new Html5Qrcode("reader");
    qr.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 280 },
      decoded => {
        qr.stop().then(() => {
          markAttendance(decoded);
          document.getElementById("scanner").style.display = "none";
        });
      },
      err => {
        // Ignored scanning errors
      }
    ).catch(err => {
      alert("Unable to start QR scanner: " + err);
      document.getElementById("scanner").style.display = "none";
    });

    // Save reference to QR scanner to stop on close
    window._qrScanner = qr;
  }

  function closeScanner() {
    if (window._qrScanner) {
      window._qrScanner.stop().catch(() => {}).finally(() => {
        document.getElementById("scanner").style.display = "none";
        window._qrScanner = null;
      });
    } else {
      document.getElementById("scanner").style.display = "none";
    }
  }

  loadTable();

  // Accessibility: allow fab button activation by keyboard
  document.querySelector(".fab").addEventListener("keydown", (e) => {
    if (e.key === "Enter" || e.key === " ") {
      e.preventDefault();
      openScanner();
    }
  });
</script>

</body>
</html>
